%% Cm,LE and xcp vs AoA for each airspeed (minimal script)
clear; close all; clc;


xc_low = [0 0.075 0.1 0.2 0.3 0.4 0.5 0.6 0.7];
xi = xc_low(:);                 % force column vector for safe math


AoA_deg  = [0 4 8 12 16];

speed_names = ["twenty","thirty five","fifty"];
U_list      = [20 35 50];

% Static pressure for each speed (Pa)
pinf_list = [238.069, 728.45, 1313.75];

% AoA names (for filenames)
aoa_names = ["zero","four","eight","twelve","sixteen"];

rho = 1.1807;

% storage
CmLE = zeros(numel(U_list), numel(AoA_deg));
xcp  = zeros(numel(U_list), numel(AoA_deg));   % center of pressure location (x/c)


% Main loop: read, compute Cp, compute CmLE and xcp

for i = 1:numel(U_list)
    U    = U_list(i);
    Qinf = 0.5*rho*U^2;
    pinf = pinf_list(i);

    for j = 1:numel(AoA_deg)

        % Build filename like: "fifty - zero"
        fname = speed_names(i) + " - " + aoa_names(j);
        disp("Reading: " + fname)

        data = readmatrix(fname, 'NumHeaderLines', 2);
        P = data(:,2);

        % Pressure taps (matching your ordering)
        P_upper = P(1:10);
        P_lower = P([1, 11:18]);

        % Cp
        CpU = (P_upper - pinf)./Qinf;    % 10x1
        CpL = (P_lower - pinf)./Qinf;    % 9x1

        % Match CpU to the same 9 x/c locations as CpL (common grid)
        CpU_common = CpU(1:numel(CpL));

        % Force column vectors (prevents row/column mismatch)
        CpU_common = CpU_common(:);
        CpL        = CpL(:);

        % Moment coefficient about Leading Edge (xref = 0):
        % Cm,LE = âˆ«_0^1 (CpU - CpL) * (x/c) d(x/c)
        CmLE(i,j) = trapz(xi, (CpU_common - CpL) .* xi);

        % Center of pressure location (as given)
        xcp(i,j) = -CmLE(i,j);  % (x/c)
    end
end


% Plot Cm,LE vs AoA (3 curves on 1 figure)

figure; grid on; hold on;
for i = 1:numel(U_list)
    plot(AoA_deg, CmLE(i,:), '-o', 'LineWidth', 1.5, ...
        'DisplayName', sprintf('U = %d m/s', U_list(i)));
end
xlabel('Angle of Attack, \alpha (deg)');
ylabel('C_{m,LE}');
title('Moment Coefficient about Leading Edge vs AoA');
legend('Location','Best');


% Plot xcp vs AoA (3 curves on 1 figure)

figure; grid on; hold on;
for i = 1:numel(U_list)
    plot(AoA_deg, xcp(i,:), '-o', 'LineWidth', 1.5, ...
        'DisplayName', sprintf('U = %d m/s', U_list(i)));
end
xlabel('Angle of Attack, \alpha (deg)');
ylabel('x_{cp} (x/c)');
title('Center of Pressure Location vs AoA');
legend('Location','Best');

